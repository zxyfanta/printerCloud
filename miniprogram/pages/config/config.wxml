<!--config.wxml-->
<view class="page">
  <view class="content">
    <!-- æ–‡ä»¶ä¿¡æ¯ -->
    <view class="file-section card">
      <view class="section-title">æ–‡ä»¶ä¿¡æ¯</view>
      <view class="file-info">
        <view class="file-icon">
          <text>{{fileInfo.icon}}</text>
        </view>
        <view class="file-details">
          <text class="file-name">{{fileInfo.name}}</text>
          <text class="file-desc">{{fileInfo.size}}</text>
          <text class="file-pages" wx:if="{{fileInfo.status === 4}}">å…± {{fileInfo.pageCount}} é¡µ âœ…</text>
          <text class="file-pages parsing" wx:elif="{{fileInfo.status === 2}}">æ­£åœ¨è®¡ç®—MD5... â³</text>
          <text class="file-pages parsing" wx:elif="{{fileInfo.status === 3}}">æ­£åœ¨è§£æé¡µæ•°... â³</text>
          <text class="file-pages error" wx:elif="{{fileInfo.status === 5}}">å¤„ç†å¤±è´¥ï¼Œé¢„è®¡ {{fileInfo.pageCount}} é¡µ âŒ</text>
          <text class="file-pages" wx:else>é¢„è®¡ {{fileInfo.pageCount}} é¡µ</text>
        </view>
      </view>
    </view>

    <!-- æ‰“å°è®¾ç½® -->
    <view class="print-config card">
      <view class="section-title">æ‰“å°è®¾ç½®</view>
      
      <!-- æ‰“å°ä»½æ•° -->
      <view class="config-item">
        <view class="config-label">æ‰“å°ä»½æ•°</view>
        <view class="config-control">
          <view class="number-input">
            <button class="number-btn" bindtap="changeCopies" data-type="minus">-</button>
            <input class="number-value" type="number" value="{{printConfig.copies}}" 
                   bindinput="onCopiesInput" maxlength="3"/>
            <button class="number-btn" bindtap="changeCopies" data-type="plus">+</button>
          </view>
        </view>
      </view>

      <!-- é¡µæ•°èŒƒå›´ -->
      <view class="config-item">
        <view class="config-label">é¡µæ•°èŒƒå›´</view>
        <view class="config-control">
          <view class="page-range-options">
            <view class="range-option {{printConfig.pageRangeType === 'all' ? 'active' : ''}}"
                  bindtap="selectPageRange" data-type="all">
              <text>å…¨éƒ¨é¡µé¢</text>
            </view>
            <view class="range-option {{printConfig.pageRangeType === 'custom' ? 'active' : ''}}"
                  bindtap="selectPageRange" data-type="custom">
              <text>è‡ªå®šä¹‰</text>
            </view>
          </view>
          <view class="custom-range" wx:if="{{printConfig.pageRangeType === 'custom'}}">
            <input class="range-input" placeholder="å¦‚ï¼š1-5,8,10-12" 
                   value="{{printConfig.pageRange}}" bindinput="onPageRangeInput"/>
            <text class="range-tip">æ”¯æŒå•é¡µå’ŒèŒƒå›´ï¼Œç”¨é€—å·åˆ†éš”</text>
          </view>
        </view>
      </view>

      <!-- é¢œè‰²é€‰æ‹© -->
      <view class="config-item">
        <view class="config-label">é¢œè‰²</view>
        <view class="config-control">
          <view class="color-options">
            <view class="color-option {{!printConfig.isColor ? 'active' : ''}}"
                  bindtap="selectColor" data-color="false">
              <view class="option-icon">âš«</view>
              <text class="option-text">é»‘ç™½</text>
              <text class="option-price">Â¥{{priceConfig.blackWhite}}/é¡µ</text>
            </view>
            <view class="color-option {{printConfig.isColor ? 'active' : ''}}"
                  bindtap="selectColor" data-color="true">
              <view class="option-icon">ğŸŒˆ</view>
              <text class="option-text">å½©è‰²</text>
              <text class="option-price">Â¥{{priceConfig.color}}/é¡µ</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å•åŒé¢ -->
      <view class="config-item">
        <view class="config-label">å•åŒé¢</view>
        <view class="config-control">
          <view class="side-options">
            <view class="side-option {{!printConfig.isDoubleSide ? 'active' : ''}}"
                  bindtap="selectSide" data-side="false">
              <view class="option-icon">ğŸ“„</view>
              <text class="option-text">å•é¢</text>
            </view>
            <view class="side-option {{printConfig.isDoubleSide ? 'active' : ''}}"
                  bindtap="selectSide" data-side="true">
              <view class="option-icon">ğŸ“‹</view>
              <text class="option-text">åŒé¢</text>
              <text class="option-discount">{{priceConfig.doubleSideDiscountText}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- çº¸å¼ è§„æ ¼ -->
      <view class="config-item">
        <view class="config-label">çº¸å¼ è§„æ ¼</view>
        <view class="config-control">
          <picker bindchange="onPaperSizeChange" value="{{paperSizeIndex}}" range="{{paperSizes}}">
            <view class="picker-display">
              <text>{{printConfig.paperSize}}</text>
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="config-item">
        <view class="config-label">å¤‡æ³¨ä¿¡æ¯</view>
        <view class="config-control">
          <textarea class="remark-input" placeholder="è¯·è¾“å…¥ç‰¹æ®Šè¦æ±‚æˆ–å–ä»¶æ—¶é—´ç­‰ä¿¡æ¯"
                    value="{{printConfig.remark}}" bindinput="onRemarkInput" maxlength="200"/>
          <text class="char-count">{{printConfig.remark.length}}/200</text>
        </view>
      </view>
    </view>

    <!-- ä»·æ ¼è®¡ç®— -->
    <view class="price-section card">
      <view class="section-title">è´¹ç”¨æ˜ç»†</view>
      <view class="price-item">
        <text class="price-label">æ‰“å°é¡µæ•°</text>
        <text class="price-value">{{calculatedPages}}é¡µ</text>
      </view>
      <view class="price-item">
        <text class="price-label">æ‰“å°ä»½æ•°</text>
        <text class="price-value">{{printConfig.copies}}ä»½</text>
      </view>
      <view class="price-item">
        <text class="price-label">å•ä»·</text>
        <text class="price-value">Â¥{{unitPrice}}/é¡µ</text>
      </view>
      <view class="price-item" wx:if="{{printConfig.isDoubleSide}}">
        <text class="price-label">åŒé¢æŠ˜æ‰£</text>
        <text class="price-value discount">{{priceConfig.doubleSideDiscountPercentText}}</text>
      </view>
      <view class="price-total">
        <text class="total-label">æ€»è®¡</text>
        <text class="total-amount">Â¥{{totalAmount}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="btn-secondary" bindtap="goBack">è¿”å›</button>
      <button class="btn-primary" bindtap="createOrder" disabled="{{!canCreateOrder || creatingOrder}}">
        {{creatingOrder ? 'åˆ›å»ºä¸­...' : 'ç¡®è®¤è®¢å•'}}
      </button>
    </view>
  </view>

  <!-- ç¡®è®¤å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showConfirmModal}}" bindtap="cancelCreateOrder">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">ç¡®è®¤è®¢å•ä¿¡æ¯</text>
      </view>

      <view class="modal-body">
        <view class="confirm-item">
          <text class="confirm-label">æ–‡ä»¶åç§°</text>
          <text class="confirm-value">{{fileInfo.name}}</text>
        </view>
        <view class="confirm-item">
          <text class="confirm-label">æ‰“å°é¡µæ•°</text>
          <text class="confirm-value">{{calculatedPages}}é¡µ</text>
        </view>
        <view class="confirm-item">
          <text class="confirm-label">æ‰“å°ä»½æ•°</text>
          <text class="confirm-value">{{printConfig.copies}}ä»½</text>
        </view>
        <view class="confirm-item">
          <text class="confirm-label">é¢œè‰²</text>
          <text class="confirm-value">{{getColorText(printConfig.isColor)}}</text>
        </view>
        <view class="confirm-item">
          <text class="confirm-label">å•åŒé¢</text>
          <text class="confirm-value">{{getSideText(printConfig.isDoubleSide)}}</text>
        </view>
        <view class="confirm-item">
          <text class="confirm-label">çº¸å¼ è§„æ ¼</text>
          <text class="confirm-value">{{printConfig.paperSize}}</text>
        </view>
        <view class="confirm-item">
          <text class="confirm-label">é¡µæ•°èŒƒå›´</text>
          <text class="confirm-value">{{getPageRangeText(printConfig.pageRangeType, printConfig.pageRange, fileInfo.pageCount)}}</text>
        </view>
        <view class="confirm-item" wx:if="{{printConfig.remark}}">
          <text class="confirm-label">å¤‡æ³¨</text>
          <text class="confirm-value">{{printConfig.remark}}</text>
        </view>
        <view class="confirm-total">
          <text class="total-label">æ€»é‡‘é¢</text>
          <text class="total-amount">Â¥{{totalAmount}}</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-cancel" bindtap="cancelCreateOrder">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmCreateOrder">ç¡®è®¤åˆ›å»º</button>
      </view>
    </view>
  </view>
</view>
