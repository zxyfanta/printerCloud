<!--orders.wxml-->
<view class="page">
  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="status-filter">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-list">
        <view class="filter-item {{currentStatus === -1 ? 'active' : ''}}" 
              bindtap="filterByStatus" data-status="-1">
          <text>å…¨éƒ¨</text>
        </view>
        <view class="filter-item {{currentStatus === 0 ? 'active' : ''}}" 
              bindtap="filterByStatus" data-status="0">
          <text>å¾…æ”¯ä»˜</text>
        </view>
        <view class="filter-item {{currentStatus === 1 ? 'active' : ''}}" 
              bindtap="filterByStatus" data-status="1">
          <text>å·²æ”¯ä»˜</text>
        </view>
        <view class="filter-item {{currentStatus === 2 ? 'active' : ''}}" 
              bindtap="filterByStatus" data-status="2">
          <text>æ‰“å°ä¸­</text>
        </view>
        <view class="filter-item {{currentStatus === 3 ? 'active' : ''}}" 
              bindtap="filterByStatus" data-status="3">
          <text>å·²å®Œæˆ</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <view class="content">
    <!-- è®¢å•åˆ—è¡¨ -->
    <view class="order-list" wx:if="{{orderList.length > 0}}">
      <view class="order-item" wx:for="{{orderList}}" wx:key="id" 
            bindtap="goToOrderDetail" data-id="{{item.id}}">
        
        <!-- è®¢å•å¤´éƒ¨ -->
        <view class="order-header">
          <view class="order-info">
            <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
            <text class="order-time">{{item.createTime}}</text>
          </view>
          <view class="order-status">
            <text class="status-text status-{{item.statusClass}}">{{item.statusText}}</text>
          </view>
        </view>

        <!-- æ–‡ä»¶ä¿¡æ¯ -->
        <view class="file-section">
          <view class="file-icon">
            <text>{{item.fileIcon}}</text>
          </view>
          <view class="file-info">
            <text class="file-name">{{item.fileName}}</text>
            <text class="file-desc">
              {{item.copies}}ä»½ Â· {{item.actualPages}}é¡µ Â· 
              {{item.isColor ? 'å½©è‰²' : 'é»‘ç™½'}} Â· 
              {{item.isDoubleSide ? 'åŒé¢' : 'å•é¢'}}
            </text>
          </view>
        </view>

        <!-- éªŒè¯ç ï¼ˆå·²æ”¯ä»˜è®¢å•æ˜¾ç¤ºï¼‰ -->
        <view class="verify-section" wx:if="{{item.status >= 1 && item.status <= 3}}">
          <view class="verify-label">å–ä»¶éªŒè¯ç ï¼š</view>
          <view class="verify-code">{{item.verifyCode}}</view>
          <view class="verify-tip">è¯·å‡­æ­¤éªŒè¯ç åˆ°æ‰“å°åº—å–ä»¶</view>
        </view>

        <!-- å¤‡æ³¨ä¿¡æ¯ -->
        <view class="remark-section" wx:if="{{item.remark}}">
          <text class="remark-label">å¤‡æ³¨ï¼š</text>
          <text class="remark-text">{{item.remark}}</text>
        </view>

        <!-- è®¢å•åº•éƒ¨ -->
        <view class="order-footer">
          <view class="amount-info">
            <text class="amount-label">æ€»é‡‘é¢ï¼š</text>
            <text class="amount-value">Â¥{{item.amount}}</text>
          </view>
          
          <view class="order-actions">
            <!-- å¾…æ”¯ä»˜çŠ¶æ€ -->
            <block wx:if="{{item.status === 0}}">
              <button class="btn-secondary btn-small" 
                      bindtap="cancelOrder" data-id="{{item.id}}" catchtap="stopPropagation">
                å–æ¶ˆè®¢å•
              </button>
              <button class="btn-primary btn-small" 
                      bindtap="payOrder" data-id="{{item.id}}" catchtap="stopPropagation">
                ç«‹å³æ”¯ä»˜
              </button>
            </block>
            
            <!-- å·²å®ŒæˆçŠ¶æ€ -->
            <block wx:if="{{item.status === 3}}">
              <button class="btn-secondary btn-small" 
                      bindtap="reorder" data-id="{{item.id}}" catchtap="stopPropagation">
                å†æ¬¡æ‰“å°
              </button>
            </block>
            
            <!-- å…¶ä»–çŠ¶æ€ -->
            <block wx:if="{{item.status === 1 || item.status === 2}}">
              <button class="btn-secondary btn-small" 
                      bindtap="contactService" catchtap="stopPropagation">
                è”ç³»å®¢æœ
              </button>
            </block>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{orderList.length === 0 && !loading}}">
      <view class="empty-icon">ğŸ“‹</view>
      <text class="empty-text">æš‚æ— è®¢å•è®°å½•</text>
      <button class="btn-primary mt-20" bindtap="goToUpload">ç«‹å³ä¸Šä¼ æ–‡ä»¶</button>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
