# 云打印小程序开发指南

## 项目概述

本项目是一个基于微信小程序和Java Spring Boot的云打印业务系统，用户可以通过小程序上传文件、配置打印参数、完成支付，然后到打印店凭验证码取件。

## 技术架构

### 前端（微信小程序）
- **框架**: 原生微信小程序
- **主要功能**:
  - 用户登录（微信授权）
  - 文件上传和预览
  - 打印参数配置
  - 微信支付
  - 订单管理
  - 历史记录查询

### 后端（Java Spring Boot）
- **框架**: Spring Boot 2.7.14
- **数据库**: MySQL 8.0
- **缓存**: Redis
- **文件存储**: 阿里云OSS
- **支付**: 微信支付API
- **主要功能**:
  - 用户管理
  - 文件管理
  - 订单管理
  - 支付处理
  - 验证码生成

## 核心功能模块

### 1. 用户管理模块
- 微信小程序授权登录
- 用户信息管理
- 登录状态维护

### 2. 文件管理模块
- 文件上传（支持PDF、Word、Excel、图片等）
- 文件预览
- 文件页数解析
- 文件存储管理

### 3. 订单管理模块
- 订单创建
- 打印参数配置（份数、页数、彩色/黑白、单双面等）
- 订单状态管理
- 历史订单查询

### 4. 支付模块
- 价格计算
- 微信支付集成
- 支付状态回调
- 退款处理

### 5. 验证码模块
- 验证码生成
- 验证码验证
- 取件管理

## 数据库设计

### 主要数据表
1. **pc_user** - 用户表
2. **pc_print_file** - 打印文件表
3. **pc_print_order** - 打印订单表
4. **pc_payment_record** - 支付记录表

详细的数据库结构请参考 `docs/database.sql`

## 开发环境搭建

### 后端环境
1. **Java 8+**
2. **Maven 3.6+**
3. **MySQL 8.0**
4. **Redis**

### 前端环境
1. **微信开发者工具**
2. **微信小程序账号**

## 配置说明

### 后端配置
在 `application.yml` 中配置：
- 数据库连接信息
- Redis连接信息
- 微信小程序AppID和AppSecret
- 微信支付商户信息
- 阿里云OSS配置

### 小程序配置
在 `app.js` 中配置：
- 后端API地址
- 小程序AppID

## 部署指南

### 后端部署
1. 打包项目：`mvn clean package`
2. 上传jar包到服务器
3. 配置数据库和Redis
4. 启动服务：`java -jar printer-cloud-backend-1.0.0.jar`

### 小程序部署
1. 使用微信开发者工具打开项目
2. 配置正确的AppID
3. 上传代码并提交审核
4. 审核通过后发布

## API接口文档

### 认证相关
- `POST /api/auth/login` - 微信登录
- `GET /api/auth/userinfo` - 获取用户信息
- `POST /api/auth/update` - 更新用户信息

### 文件相关
- `POST /api/file/upload` - 文件上传
- `GET /api/file/{id}` - 获取文件信息
- `DELETE /api/file/{id}` - 删除文件

### 订单相关
- `POST /api/order/create` - 创建订单
- `GET /api/order/list` - 订单列表
- `GET /api/order/{id}` - 订单详情
- `POST /api/order/cancel` - 取消订单

### 支付相关
- `POST /api/pay/create` - 创建支付
- `POST /api/pay/notify` - 支付回调
- `POST /api/pay/refund` - 申请退款

## 开发注意事项

1. **安全性**
   - 所有API接口都需要进行用户身份验证
   - 敏感信息不要硬编码在代码中
   - 文件上传需要进行格式和大小限制

2. **性能优化**
   - 使用Redis缓存热点数据
   - 文件上传使用分片上传
   - 数据库查询添加适当索引

3. **错误处理**
   - 统一的错误响应格式
   - 详细的错误日志记录
   - 用户友好的错误提示

4. **测试**
   - 单元测试覆盖核心业务逻辑
   - 集成测试验证API接口
   - 小程序真机测试

## 后续扩展

1. **功能扩展**
   - 支持更多文件格式
   - 添加打印店管理后台
   - 支持批量打印
   - 添加会员系统

2. **技术优化**
   - 引入消息队列处理异步任务
   - 使用微服务架构
   - 添加监控和日志系统
   - 使用CDN加速文件访问

## 联系方式

如有问题，请联系开发团队。
